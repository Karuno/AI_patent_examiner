{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Case Digest Unified Schema",
  "description": "統合版 case_digest スキーマ v2. 条文ごとの判断結論と理由・根拠を請求項単位で保持する。",
  "type": "object",
  "properties": {
    "meta": {
      "type": "object",
      "properties": {
        "schema_version": {
          "type": "string"
        },
        "compiled_on": {
          "type": "string",
          "format": "date"
        },
        "source": {
          "type": "string"
        }
      },
      "required": [
        "schema_version",
        "compiled_on"
      ]
    },
    "application": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string"
        },
        "app-num": {
          "type": "string"
          }
        },      
      "required": [
        "app-num"
      ]
    },
    "prior_arts": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "doc_id": {
            "type": "string"
          },
          "extracts": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "loc": {
                  "type": "string"
                },
                "text": {
                  "type": "string"
                }
              },
              "required": [
                "loc"
              ]
            }
          }
        },
        "required": [
          "id",
          "doc_id"
        ]
      }
    },
    "conclusions": {
      "type": "array",
      "description": "請求項ごとの条文別結論。reject/allowと判断理由を保持。",
      "items": {
        "type": "object",
        "properties": {
          "claim": {
            "type": "string"
          },
          "article": {
            "type": "string"
          },
          "decision": {
            "type": "string",
            "enum": [
              "reject",
              "allow"
            ]
          },
          "judgments": {
            "type": "array",
            "description": "判断要素（類型・根拠）",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "criteria_json に対応する judgment_id"
                },
                "summary": {
                  "type": "string"
                },
                "supporting_refs": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "ref_id": {
                        "type": "string"
                      },
                      "description": {
                        "type": "object",
                        "properties": {
                          "doc_id": {
                            "type": "string"
                          },
                          "locations": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "loc": {
                                  "type": "string"
                                }
                              },
                              "required": [
                                "loc"
                              ]
                            }
                          }
                        },
                        "required": [
                          "doc_id"
                        ]
                      }
                    },
                    "required": [
                      "ref_id",
                      "description"
                    ]
                  }
                },
                "why_ids": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "required": [
                "id",
                "summary"
              ]
            }
          },
          "main_prior_art": {
            "type": "string"
          },
          "secondary_priors": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rationale_type": {
            "type": "string",
            "description": "進歩性判断の論理付け類型"
          },
          "article_specific": {
            "type": "object",
            "properties": {
              "support_type": {
                "type": "string",
                "description": "36条サポート要件の類型(1)(3)(4)"
              },
              "support_type3_context": {
                "type": "object",
                "properties": {
                  "technical_field": {
                    "type": "string"
                  },
                  "common_general_knowledge": {
                    "type": "string"
                  }
                }
              },
              "support_type4_context": {
                "type": "object",
                "properties": {
                  "recognized_problem": {
                    "type": "string"
                  },
                  "recognized_means": {
                    "type": "string"
                  },
                  "why_not_reflected": {
                    "type": "string"
                  }
                }
              },
              "clarity_type": {
                "type": "string",
                "description": "36条明確性の判断類型(1)-(5)"
              }
            }
          },
          "notes": {
            "type": "string"
          }
        },
        "required": [
          "claim",
          "article",
          "decision"
        ]
      }
    }
  },
  "required": [
    "meta",
    "application",
    "prior_arts",
    "conclusions"
  ]
}